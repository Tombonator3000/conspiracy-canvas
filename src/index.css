@import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Special+Elite&family=Courier+Prime:wght@400;700&family=VT323&family=Press+Start+2P&family=Caveat:wght@400;700&family=Nanum+Pen+Script&family=Rock+Salt&family=Shadows+Into+Light&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Cork board dark theme */
    --background: 30 25% 12%;
    --foreground: 40 30% 90%;

    --card: 40 20% 88%;
    --card-foreground: 30 30% 15%;

    --popover: 30 25% 15%;
    --popover-foreground: 40 30% 90%;

    --primary: 350 70% 45%;
    --primary-foreground: 40 30% 95%;

    --secondary: 35 40% 25%;
    --secondary-foreground: 40 30% 90%;

    --muted: 30 20% 20%;
    --muted-foreground: 40 20% 60%;

    --accent: 45 80% 55%;
    --accent-foreground: 30 30% 10%;

    --destructive: 0 70% 50%;
    --destructive-foreground: 40 30% 95%;

    --border: 30 20% 25%;
    --input: 30 20% 25%;
    --ring: 350 70% 45%;

    --radius: 0.25rem;

    /* Custom game colors */
    --cork: 30 35% 18%;
    --cork-light: 35 30% 25%;
    --paper: 45 30% 92%;
    --paper-aged: 40 25% 85%;
    --string-red: 350 80% 50%;
    --string-glow: 350 100% 60%;
    --ink: 220 15% 20%;
    --marker-red: 355 85% 45%;
    --sticky-yellow: 50 90% 75%;
    --sanity-green: 120 60% 45%;
    --sanity-red: 0 70% 50%;
    
    /* Madness effects */
    --noise-opacity: 0;
    --distort-amount: 0deg;
    --vignette-intensity: 0;

    /* 90s Analog filter effects */
    --film-grain-opacity: 0.08;
    --chromatic-offset: 0px;
    --scanline-opacity: 0;
    --vignette-darkness: 0.4;
  }

  .dark {
    --background: 30 25% 8%;
    --foreground: 40 30% 90%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-family: 'Courier Prime', 'Courier New', monospace;
  }
}

@layer components {
  /* Cork board texture */
  .cork-texture {
    background-color: hsl(var(--cork));
    background-image: 
      url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    background-blend-mode: overlay;
  }

  /* Paper texture overlay - The Secret Sauce */
  .paper-texture {
    position: relative;
  }
  
  .paper-texture::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: url("https://images.unsplash.com/photo-1586075010923-2dd4570fb338?q=80&w=600&auto=format&fit=crop");
    background-size: cover;
    background-blend-mode: multiply;
    opacity: 0.15;
    pointer-events: none;
    border-radius: inherit;
  }

  /* Paper base texture - applies to ALL evidence nodes */
  .paper-base {
    position: relative;
    background-color: #fdfdfd;
    background-image: url('https://www.transparenttextures.com/patterns/old-wall.png');
    background-repeat: repeat;
  }

  /* Evidence card styles */
  .evidence-card {
    @apply bg-card rounded-sm;
    transform: rotate(var(--rotation, 0deg));
    box-shadow: 
      2px 4px 12px rgba(0, 0, 0, 0.35),
      1px 2px 4px rgba(0, 0, 0, 0.2),
      0 0 0 1px rgba(0, 0, 0, 0.08);
    transition: box-shadow 0.2s ease, transform 0.2s ease;
  }

  .evidence-card:hover {
    box-shadow: 
      4px 8px 20px rgba(0, 0, 0, 0.4),
      2px 4px 8px rgba(0, 0, 0, 0.25),
      0 0 0 1px rgba(0, 0, 0, 0.1);
  }

  /* Combine target highlight */
  .combine-target-highlight {
    outline: 3px dashed hsl(var(--accent));
    outline-offset: 4px;
    animation: pulse-highlight 0.6s ease-in-out infinite;
  }

  @keyframes pulse-highlight {
    0%, 100% { outline-color: hsl(var(--accent) / 1); }
    50% { outline-color: hsl(var(--accent) / 0.4); }
  }

  /* Combinable item glow - shows when two items that can combine are nearby */
  .combinable-glow {
    box-shadow:
      0 0 15px 5px rgba(255, 215, 0, 0.4),
      0 0 30px 10px rgba(255, 215, 0, 0.2),
      inset 0 0 10px rgba(255, 215, 0, 0.1);
    animation: combinable-pulse 1.5s ease-in-out infinite;
  }

  @keyframes combinable-pulse {
    0%, 100% {
      box-shadow:
        0 0 15px 5px rgba(255, 215, 0, 0.4),
        0 0 30px 10px rgba(255, 215, 0, 0.2);
    }
    50% {
      box-shadow:
        0 0 25px 8px rgba(255, 215, 0, 0.6),
        0 0 45px 15px rgba(255, 215, 0, 0.3);
    }
  }

  /* Chain combination glow - for items that result from combinations */
  .chain-combinable-glow {
    box-shadow:
      0 0 15px 5px rgba(138, 43, 226, 0.4),
      0 0 30px 10px rgba(138, 43, 226, 0.2);
    animation: chain-pulse 1.2s ease-in-out infinite;
  }

  @keyframes chain-pulse {
    0%, 100% {
      box-shadow:
        0 0 15px 5px rgba(138, 43, 226, 0.4),
        0 0 30px 10px rgba(138, 43, 226, 0.2);
    }
    50% {
      box-shadow:
        0 0 25px 8px rgba(138, 43, 226, 0.6),
        0 0 45px 15px rgba(138, 43, 226, 0.3);
    }
  }

  /* UV hint text for combinations */
  .uv-combination-hint {
    position: absolute;
    bottom: -24px;
    left: 50%;
    transform: translateX(-50%);
    color: #7fff00;
    font-family: monospace;
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
    white-space: nowrap;
    text-shadow: 0 0 8px rgba(127, 255, 0, 0.8);
    animation: uv-flicker 2s ease-in-out infinite;
  }

  @keyframes uv-flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
    75% { opacity: 0.9; }
  }

  /* Spawning animation burst */
  .spawning-node {
    animation: spawn-burst 0.5s ease-out;
  }

  @keyframes spawn-burst {
    0% {
      transform: scale(0) rotate(0deg);
      opacity: 0;
    }
    50% {
      transform: scale(1.3) rotate(-5deg);
      opacity: 0.8;
    }
    100% {
      transform: scale(1) rotate(var(--rotation, 0deg));
      opacity: 1;
    }
  }

  .evidence-photo {
    @apply evidence-card paper-texture p-2;
    background: linear-gradient(
      145deg,
      hsl(var(--paper)) 0%,
      hsl(var(--paper-aged)) 60%,
      hsl(40 20% 80%) 100%
    );
    border-radius: 2px 2px 2px 12px; /* One corner curled */
  }

  .evidence-document {
    @apply evidence-card paper-texture p-3;
    background: linear-gradient(
      180deg,
      hsl(var(--paper)) 0%,
      hsl(var(--paper-aged)) 70%,
      hsl(38 22% 82%) 100%
    );
    border-left: 3px solid hsl(var(--primary));
    border-radius: 1px 3px 3px 1px;
  }

  /* Newspaper clipping with torn edges */
  .evidence-clipping {
    @apply evidence-card paper-texture p-3;
    background: linear-gradient(
      135deg,
      hsl(45 25% 88%) 0%,
      hsl(40 20% 82%) 50%,
      hsl(35 18% 78%) 100%
    );
    clip-path: polygon(2% 0%, 98% 1%, 100% 98%, 85% 96%, 75% 100%, 60% 98%, 40% 100%, 25% 97%, 0% 100%);
    filter: sepia(0.1);
  }

  .evidence-sticky {
    @apply paper-texture rounded-none p-3;
    background: linear-gradient(
      135deg,
      hsl(var(--sticky-yellow)) 0%,
      hsl(50 85% 70%) 40%,
      hsl(48 75% 65%) 100%
    );
    transform: rotate(var(--rotation, -2deg));
    box-shadow: 
      1px 8px 16px rgba(0, 0, 0, 0.25),
      0 2px 4px rgba(0, 0, 0, 0.15);
    /* Peeling effect - top sticks, bottom lifts */
    border-radius: 0 0 3px 3px;
  }
  
  .evidence-sticky::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(
      to bottom,
      hsl(50 70% 60%) 0%,
      transparent 100%
    );
    opacity: 0.5;
  }

  /* Handwritten scribble text */
  .scribble {
    font-family: 'Permanent Marker', cursive;
    text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.1);
  }

  /* Scribble variant: Error (red) - default for mistakes */
  .scribble-error {
    color: hsl(var(--marker-red));
    text-shadow:
      1px 1px 0 rgba(0, 0, 0, 0.2),
      0 0 10px rgba(194, 28, 56, 0.5);
  }

  /* Scribble variant: Success (green) - for valid connections */
  .scribble-success {
    color: #22c55e;
    text-shadow:
      1px 1px 0 rgba(0, 0, 0, 0.2),
      0 0 12px rgba(34, 197, 94, 0.6),
      0 0 20px rgba(34, 197, 94, 0.3);
  }

  /* Scribble variant: Insight (blue/cyan) - for discoveries/combinations */
  .scribble-insight {
    color: #06b6d4;
    text-shadow:
      1px 1px 0 rgba(0, 0, 0, 0.2),
      0 0 15px rgba(6, 182, 212, 0.7),
      0 0 25px rgba(6, 182, 212, 0.4);
    animation: insight-glow 1s ease-in-out infinite alternate;
  }

  @keyframes insight-glow {
    from {
      text-shadow:
        1px 1px 0 rgba(0, 0, 0, 0.2),
        0 0 15px rgba(6, 182, 212, 0.7),
        0 0 25px rgba(6, 182, 212, 0.4);
    }
    to {
      text-shadow:
        1px 1px 0 rgba(0, 0, 0, 0.2),
        0 0 20px rgba(6, 182, 212, 0.9),
        0 0 35px rgba(6, 182, 212, 0.6);
    }
  }

  /* Scribble variant: Paranoia (purple/red) - for low sanity whispers */
  .scribble-paranoia {
    color: #a855f7;
    text-shadow:
      2px 0 #ef4444,
      -2px 0 #3b82f6,
      0 0 15px rgba(168, 85, 247, 0.8);
    animation: paranoia-glitch 0.3s ease-in-out infinite;
  }

  @keyframes paranoia-glitch {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-2px) skewX(1deg); }
    50% { transform: translateX(2px); }
    75% { transform: translateX(-1px) skewX(-1deg); }
  }

  /* Scribble feedback - ephemeral text that fades out */
  .scribble-feedback {
    animation: scribble-fade 2s ease-out forwards;
    pointer-events: none;
  }

  @keyframes scribble-fade {
    0% {
      opacity: 1;
      transform: scale(1);
    }
    70% {
      opacity: 1;
      transform: scale(1);
    }
    100% {
      opacity: 0;
      transform: scale(0.9) translateY(-10px);
    }
  }

  .typewriter {
    font-family: 'Special Elite', 'Courier Prime', monospace;
  }

  /* Red string connection */
  .string-valid {
    stroke: hsl(var(--string-red));
    stroke-width: 3px;
    filter: drop-shadow(0 0 4px hsl(var(--string-glow) / 0.6));
  }

  .string-invalid {
    stroke: hsl(var(--muted-foreground));
    stroke-width: 1px;
    stroke-dasharray: 5 5;
  }

  /* Sanity meter */
  .sanity-meter {
    background: linear-gradient(
      90deg,
      hsl(var(--sanity-red)) 0%,
      hsl(var(--sanity-green)) 100%
    );
  }

  /* Madness overlay */
  .madness-overlay {
    pointer-events: none;
    position: fixed;
    inset: 0;
    z-index: 1000;
    background: 
      radial-gradient(
        ellipse at center,
        transparent 0%,
        rgba(0, 0, 0, calc(var(--vignette-intensity) * 0.7)) 100%
      );
    filter: sepia(calc(var(--vignette-intensity) * 0.3));
  }

  .madness-noise {
    position: fixed;
    inset: 0;
    z-index: 999;
    pointer-events: none;
    opacity: var(--noise-opacity);
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    mix-blend-mode: overlay;
  }

  /* Push pin positioning helper - pins are now SVG in EvidenceNode */
  .push-pin {
    pointer-events: none;
  }

  /* Shake animation */
  @keyframes shake {
    0%, 100% { transform: translateX(0) rotate(var(--rotation, 0deg)); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-4px) rotate(calc(var(--rotation, 0deg) - 1deg)); }
    20%, 40%, 60%, 80% { transform: translateX(4px) rotate(calc(var(--rotation, 0deg) + 1deg)); }
  }

  .animate-shake {
    animation: shake 0.5s ease-in-out;
  }

  /* Pulse glow for success */
  @keyframes pulse-glow {
    0%, 100% { box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4), 0 0 0 0 hsl(var(--string-red) / 0.4); }
    50% { box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4), 0 0 20px 10px hsl(var(--string-red) / 0); }
  }

  .animate-pulse-glow {
    animation: pulse-glow 0.6s ease-out;
  }

  /* Scribble pop animation */
  @keyframes scribble-pop {
    0% { transform: scale(0) rotate(-10deg); opacity: 0; }
    50% { transform: scale(1.2) rotate(5deg); }
    100% { transform: scale(1) rotate(var(--scribble-rotation, -3deg)); opacity: 1; }
  }

  .animate-scribble {
    animation: scribble-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  /* React Flow overrides */
  .react-flow__edge-path {
    stroke-linecap: round;
  }

  /* Touch-friendly handles for mobile - THE FAT FINGER FIX */
  .react-flow__handle {
    width: 14px !important;
    height: 14px !important;
    background: hsl(var(--primary)) !important;
    border: 2px solid hsl(var(--card)) !important;
    border-radius: 50% !important;
    cursor: crosshair !important;
    z-index: 100 !important;
    box-shadow: 0 0 0 3px hsl(var(--primary) / 0.3) !important;
    transition: all 0.15s ease;
  }

  /* THE MAGIC FIX: Expand hit area using pseudo-element */
  .react-flow__handle::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 44px; /* Big touch target - Apple recommends 44px minimum */
    height: 44px;
    background: transparent;
    border-radius: 50%;
  }

  .react-flow__handle:hover,
  .react-flow__handle:active {
    background: hsl(var(--string-glow)) !important;
    box-shadow: 0 0 12px 6px hsl(var(--string-glow) / 0.6) !important;
    transform: scale(1.3);
  }

  /* Connection line while dragging - instant red feedback */
  .react-flow__connection-line {
    stroke: hsl(var(--string-red)) !important;
    stroke-width: 4px !important;
  }

  /* Existing connection edges */
  .react-flow__edge-path {
    stroke-linecap: round;
  }

  /* Desktop pin handle - sits exactly on the push pin */
  .desktop-pin-handle {
    width: 28px !important;
    height: 28px !important;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    cursor: crosshair !important;
  }

  .desktop-pin-handle::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 32px;
    height: 32px;
    background: transparent;
    border-radius: 50%;
    transition: all 0.15s ease;
  }

  .desktop-pin-handle:hover::after,
  .desktop-pin-handle:active::after {
    background: hsl(var(--string-glow) / 0.3);
    box-shadow: 0 0 12px 6px hsl(var(--string-glow) / 0.5);
  }

  .desktop-pin-handle:hover,
  .desktop-pin-handle:active {
    transform: translateX(-50%) scale(1.1) !important;
  }

  /* Ensure text legibility when zoomed out */
  .evidence-photo,
  .evidence-document,
  .evidence-sticky {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Prevent text from becoming too small when zoomed out */
  .react-flow__viewport {
    font-size: 1rem;
  }

  /* === CRT MONITOR EFFECTS FOR BRIEFING SCREEN === */

  /* CRT monitor container with curve effect */
  .crt-monitor {
    position: relative;
    background: #0a0a0a;
    border-radius: 8px;
    overflow: hidden;
    box-shadow:
      inset 0 0 100px rgba(0, 255, 0, 0.05),
      0 0 20px rgba(0, 0, 0, 0.8),
      0 10px 40px rgba(0, 0, 0, 0.6);
  }

  /* Inner curve simulation */
  .crt-monitor::before {
    content: "";
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse at center,
      transparent 0%,
      transparent 60%,
      rgba(0, 0, 0, 0.4) 100%
    );
    pointer-events: none;
    z-index: 10;
  }

  /* Scanlines overlay */
  .crt-scanlines {
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      to bottom,
      transparent 0px,
      transparent 1px,
      rgba(0, 0, 0, 0.3) 1px,
      rgba(0, 0, 0, 0.3) 2px
    );
    pointer-events: none;
    z-index: 20;
    animation: scanline-flicker 0.1s infinite;
  }

  @keyframes scanline-flicker {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 0.9; }
  }

  /* CRT screen glow */
  .crt-glow {
    position: absolute;
    inset: 0;
    box-shadow: inset 0 0 80px rgba(0, 255, 0, 0.1);
    pointer-events: none;
    z-index: 5;
  }

  /* Screen flicker effect */
  .crt-flicker {
    animation: crt-flicker 8s infinite;
  }

  @keyframes crt-flicker {
    0%, 100% { opacity: 1; }
    92% { opacity: 1; }
    93% { opacity: 0.95; }
    94% { opacity: 1; }
    97% { opacity: 0.98; }
    98% { opacity: 1; }
  }

  /* Terminal text glow */
  .terminal-text {
    font-family: 'VT323', 'Courier New', monospace;
    color: #00ff00;
    text-shadow:
      0 0 5px rgba(0, 255, 0, 0.8),
      0 0 10px rgba(0, 255, 0, 0.5),
      0 0 20px rgba(0, 255, 0, 0.3);
  }

  /* Pixel font for headers */
  .pixel-font {
    font-family: 'Press Start 2P', 'VT323', monospace;
    text-transform: uppercase;
  }

  /* Flashing classified header */
  .classified-flash {
    animation: classified-blink 1s infinite;
  }

  @keyframes classified-blink {
    0%, 49% { opacity: 1; }
    50%, 100% { opacity: 0.3; }
  }

  /* DOS-style window border */
  .dos-window {
    border: 3px solid #00ff00;
    box-shadow:
      inset 2px 2px 0 rgba(0, 255, 0, 0.3),
      inset -2px -2px 0 rgba(0, 100, 0, 0.5),
      0 0 20px rgba(0, 255, 0, 0.2);
    background: rgba(0, 20, 0, 0.95);
  }

  /* DOS-style button */
  .dos-button {
    font-family: 'VT323', monospace;
    background: #001a00;
    border: 2px solid #00ff00;
    color: #00ff00;
    padding: 8px 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    position: relative;
    transition: all 0.1s;
    box-shadow:
      inset 1px 1px 0 rgba(0, 255, 0, 0.4),
      inset -1px -1px 0 rgba(0, 100, 0, 0.6);
    text-shadow: 0 0 5px rgba(0, 255, 0, 0.8);
  }

  .dos-button:hover {
    background: #003300;
    box-shadow:
      0 0 15px rgba(0, 255, 0, 0.4),
      inset 1px 1px 0 rgba(0, 255, 0, 0.4),
      inset -1px -1px 0 rgba(0, 100, 0, 0.6);
  }

  .dos-button:active {
    transform: translateY(1px);
    box-shadow:
      inset 2px 2px 0 rgba(0, 100, 0, 0.6),
      inset -1px -1px 0 rgba(0, 255, 0, 0.2);
  }

  /* Typing cursor animation */
  .typing-cursor::after {
    content: "â–ˆ";
    animation: blink-cursor 0.7s infinite;
  }

  @keyframes blink-cursor {
    0%, 49% { opacity: 1; }
    50%, 100% { opacity: 0; }
  }

  /* Boot-up animation */
  @keyframes boot-up {
    0% {
      opacity: 0;
      filter: blur(10px);
    }
    30% {
      opacity: 0.5;
      filter: blur(5px);
    }
    100% {
      opacity: 1;
      filter: blur(0);
    }
  }

  .crt-boot {
    animation: boot-up 0.5s ease-out forwards;
  }

  /* Hard drive activity indicator */
  .hdd-activity {
    animation: hdd-blink 0.1s infinite;
  }

  @keyframes hdd-blink {
    0%, 100% { opacity: 1; background: #ff6600; }
    50% { opacity: 0.3; background: #ff3300; }
  }

  /* Redacted/classified stamp effect */
  .stamp-classified {
    position: relative;
    display: inline-block;
    padding: 4px 12px;
    border: 2px solid #ff0000;
    color: #ff0000;
    font-family: 'Press Start 2P', monospace;
    font-size: 10px;
    transform: rotate(-3deg);
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
  }

  /* Particle Animation for merge effect */
  @keyframes puff-out {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }
    100% {
      /* Move towards the random direction variables and shrink */
      transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0);
      opacity: 0;
    }
  }

  .animate-puff {
    /* Run once, stay at the end state (invisible) */
    animation: puff-out 0.7s ease-out forwards;
    position: absolute;
    border-radius: 50%;
    /* A mix of paper dust colors */
    background-color: hsl(40, 20%, 90%);
    box-shadow: 0 0 4px rgba(255, 200, 100, 0.5), 0 0 2px rgba(0,0,0,0.1);
  }

  /* Central flash effect for merge */
  @keyframes merge-flash {
    0% {
      width: 0;
      height: 0;
      opacity: 1;
      box-shadow: 0 0 30px 15px rgba(255, 220, 100, 0.8),
                  0 0 60px 30px rgba(255, 180, 50, 0.5);
    }
    50% {
      width: 80px;
      height: 80px;
      opacity: 0.8;
      box-shadow: 0 0 50px 25px rgba(255, 220, 100, 0.6),
                  0 0 80px 40px rgba(255, 180, 50, 0.3);
    }
    100% {
      width: 120px;
      height: 120px;
      opacity: 0;
      box-shadow: 0 0 0 0 transparent;
    }
  }

  .animate-merge-flash {
    animation: merge-flash 0.5s ease-out forwards;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 240, 200, 0.9) 0%, rgba(255, 200, 100, 0.6) 40%, transparent 70%);
    pointer-events: none;
  }

  /* === VICTORY GLOW EFFECT === */
  /* Applied when the player wins - all strings glow green */
  .victory-glow .react-flow__edge-path {
    stroke: #00ff41 !important; /* Hacker green */
    filter: drop-shadow(0 0 5px #00ff41) drop-shadow(0 0 10px #00ff41);
    transition: all 1s ease;
  }

  .victory-glow .react-flow__edge {
    animation: victory-pulse 1.5s ease-in-out infinite;
  }

  @keyframes victory-pulse {
    0%, 100% {
      filter: drop-shadow(0 0 5px #00ff41);
    }
    50% {
      filter: drop-shadow(0 0 15px #00ff41) drop-shadow(0 0 25px #00ff41);
    }
  }

  /* === GLITCH TEXT EFFECT === */
  /* For hallucination nodes at low sanity */
  .glitch-text {
    animation: glitch-shake 0.3s ease-in-out infinite;
    color: #ff0000 !important;
    text-shadow:
      2px 0 #00ff00,
      -2px 0 #0000ff,
      0 0 10px rgba(255, 0, 0, 0.8);
  }

  @keyframes glitch-shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-2px) skewX(1deg); }
    50% { transform: translateX(2px) skewY(-1deg); }
    75% { transform: translateX(-1px) skewX(-1deg); }
  }

  /* Encrypted node indicator (requiresUV) */
  .encrypted-node {
    position: relative;
  }

  .encrypted-node::after {
    content: "ðŸ”’";
    position: absolute;
    top: -10px;
    right: -10px;
    font-size: 16px;
    animation: lock-pulse 2s ease-in-out infinite;
  }

  @keyframes lock-pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.1); }
  }

  /* Revealed node under UV light */
  .uv-revealed {
    box-shadow:
      0 0 10px rgba(127, 255, 0, 0.5),
      0 0 20px rgba(127, 255, 0, 0.3),
      inset 0 0 5px rgba(127, 255, 0, 0.2) !important;
    border: 1px solid rgba(127, 255, 0, 0.5) !important;
  }

  /* ========================================
     90S ANALOG AESTHETIC - "The Basement Conspiracy"
     ======================================== */

  /* === FILM GRAIN OVERLAY === */
  /* Creates the VHS/analog camera feel */
  .film-grain {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9999;
    opacity: var(--film-grain-opacity, 0.08);
    mix-blend-mode: overlay;
    animation: grain-shift 0.1s steps(5) infinite;
  }

  .film-grain::before {
    content: "";
    position: absolute;
    inset: -200%;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    background-size: 200px 200px;
  }

  @keyframes grain-shift {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-2%, -2%); }
    20% { transform: translate(2%, 2%); }
    30% { transform: translate(-1%, 2%); }
    40% { transform: translate(2%, -1%); }
    50% { transform: translate(-2%, 1%); }
    60% { transform: translate(1%, -2%); }
    70% { transform: translate(-1%, -1%); }
    80% { transform: translate(2%, 1%); }
    90% { transform: translate(-2%, 2%); }
  }

  /* === PERMANENT VIGNETTE === */
  /* Dark corners - "working by lamplight" feel */
  .vignette-overlay {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9998;
    background: radial-gradient(
      ellipse 80% 60% at 50% 50%,
      transparent 0%,
      transparent 40%,
      rgba(0, 0, 0, 0.3) 70%,
      rgba(0, 0, 0, var(--vignette-darkness, 0.4)) 100%
    );
  }

  /* === CHROMATIC ABERRATION === */
  /* RGB split effect - simulates bad video quality / headache */
  .chromatic-aberration {
    position: relative;
  }

  .chromatic-aberration::before,
  .chromatic-aberration::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    mix-blend-mode: screen;
    opacity: 0.7;
  }

  .chromatic-aberration::before {
    background: inherit;
    filter: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='r'%3E%3CfeColorMatrix values='1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0'/%3E%3C/filter%3E%3C/svg%3E#r");
    transform: translateX(calc(var(--chromatic-offset, 0px) * -1));
  }

  .chromatic-aberration::after {
    background: inherit;
    filter: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='b'%3E%3CfeColorMatrix values='0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 1 0'/%3E%3C/filter%3E%3C/svg%3E#b");
    transform: translateX(var(--chromatic-offset, 0px));
  }

  /* Simpler chromatic effect for text */
  .chromatic-text {
    text-shadow:
      calc(var(--chromatic-offset, 2px) * -1) 0 rgba(255, 0, 0, 0.7),
      var(--chromatic-offset, 2px) 0 rgba(0, 255, 255, 0.7);
  }

  /* === CRT SCANLINES (Global) === */
  /* Horizontal lines that scroll slowly */
  .crt-lines {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9997;
    background: repeating-linear-gradient(
      to bottom,
      transparent 0px,
      transparent 2px,
      rgba(0, 0, 0, 0.1) 2px,
      rgba(0, 0, 0, 0.1) 4px
    );
    background-size: 100% 4px;
    animation: scanline-scroll 10s linear infinite;
    opacity: var(--scanline-opacity, 0);
  }

  @keyframes scanline-scroll {
    0% { background-position: 0 0; }
    100% { background-position: 0 100vh; }
  }

  /* === DUST PARTICLES === */
  /* Floating particles in front of the "camera" */
  .dust-particle {
    position: fixed;
    width: var(--size, 3px);
    height: var(--size, 3px);
    background: radial-gradient(circle, rgba(255, 250, 240, 0.8) 0%, rgba(255, 250, 240, 0) 70%);
    border-radius: 50%;
    pointer-events: none;
    filter: blur(1px);
    animation: dust-float var(--duration, 20s) linear infinite;
    opacity: var(--opacity, 0.6);
  }

  @keyframes dust-float {
    0% {
      transform: translate(0, 100vh) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: var(--opacity, 0.6);
    }
    90% {
      opacity: var(--opacity, 0.6);
    }
    100% {
      transform: translate(var(--drift, 50px), -100px) rotate(360deg);
      opacity: 0;
    }
  }

  /* === PAPER TEXTURES & TORN EDGES === */

  /* Newspaper clipping - yellowed, grainy */
  .paper-newspaper {
    background:
      url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.15'/%3E%3C/svg%3E"),
      linear-gradient(
        135deg,
        hsl(45 30% 85%) 0%,
        hsl(42 25% 80%) 50%,
        hsl(38 20% 75%) 100%
      );
    filter: sepia(0.15) contrast(1.05);
  }

  /* Photo - glossy with slight reflection */
  .paper-glossy {
    background: linear-gradient(
      145deg,
      hsl(0 0% 98%) 0%,
      hsl(0 0% 95%) 50%,
      hsl(0 0% 92%) 100%
    );
    box-shadow:
      inset 0 1px 0 rgba(255, 255, 255, 0.8),
      inset 0 -1px 0 rgba(0, 0, 0, 0.05);
  }

  .paper-glossy::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 60%;
    bottom: 60%;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.3) 0%,
      transparent 50%
    );
    pointer-events: none;
  }

  /* Notebook paper - lined */
  .paper-lined {
    background:
      repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 23px,
        rgba(180, 200, 220, 0.5) 23px,
        rgba(180, 200, 220, 0.5) 24px
      ),
      linear-gradient(
        to bottom,
        hsl(45 20% 96%) 0%,
        hsl(45 15% 94%) 100%
      );
    background-position: 0 8px;
  }

  /* Graph paper - grid */
  .paper-grid {
    background:
      repeating-linear-gradient(
        to right,
        transparent 0px,
        transparent 19px,
        rgba(180, 200, 220, 0.3) 19px,
        rgba(180, 200, 220, 0.3) 20px
      ),
      repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 19px,
        rgba(180, 200, 220, 0.3) 19px,
        rgba(180, 200, 220, 0.3) 20px
      ),
      linear-gradient(
        to bottom,
        hsl(45 15% 97%) 0%,
        hsl(45 10% 95%) 100%
      );
  }

  /* Torn paper edges */
  .torn-edge-top {
    clip-path: polygon(
      0% 4%, 3% 0%, 8% 3%, 12% 1%, 18% 4%, 22% 0%, 28% 2%, 33% 0%,
      38% 3%, 45% 1%, 52% 4%, 58% 0%, 65% 2%, 72% 0%, 78% 3%, 85% 1%,
      92% 4%, 97% 0%, 100% 3%, 100% 100%, 0% 100%
    );
  }

  .torn-edge-bottom {
    clip-path: polygon(
      0% 0%, 100% 0%, 100% 96%, 97% 100%, 92% 96%, 85% 99%, 78% 97%,
      72% 100%, 65% 98%, 58% 100%, 52% 96%, 45% 99%, 38% 97%, 33% 100%,
      28% 98%, 22% 100%, 18% 96%, 12% 99%, 8% 97%, 3% 100%, 0% 96%
    );
  }

  .torn-edge-all {
    clip-path: polygon(
      2% 4%, 5% 0%, 10% 3%, 15% 1%, 20% 4%, 28% 0%, 35% 2%, 42% 0%,
      50% 3%, 58% 1%, 65% 4%, 72% 0%, 80% 2%, 88% 0%, 95% 3%, 98% 1%,
      100% 5%, 97% 12%, 100% 20%, 98% 28%, 100% 35%, 97% 42%, 100% 50%,
      98% 58%, 100% 65%, 97% 72%, 100% 80%, 98% 88%, 100% 95%, 97% 98%,
      92% 96%, 85% 100%, 78% 97%, 70% 100%, 62% 97%, 55% 100%, 48% 97%,
      40% 100%, 32% 97%, 25% 100%, 18% 97%, 10% 100%, 3% 97%, 0% 95%,
      3% 88%, 0% 80%, 2% 72%, 0% 65%, 3% 58%, 0% 50%, 2% 42%, 0% 35%,
      3% 28%, 0% 20%, 2% 12%, 0% 5%
    );
  }

  /* Coffee stain overlay */
  .coffee-stain {
    position: relative;
  }

  .coffee-stain::after {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(
      ellipse at center,
      transparent 40%,
      rgba(139, 90, 43, 0.15) 50%,
      rgba(139, 90, 43, 0.1) 60%,
      transparent 70%
    );
    pointer-events: none;
    top: var(--stain-top, 20%);
    left: var(--stain-left, 60%);
    transform: rotate(var(--stain-rotate, 15deg)) scale(var(--stain-scale, 1));
  }

  /* === TAPE EFFECTS === */

  .tape {
    position: absolute;
    width: 60px;
    height: 20px;
    background: linear-gradient(
      to bottom,
      rgba(255, 248, 220, 0.85) 0%,
      rgba(245, 235, 200, 0.9) 50%,
      rgba(235, 220, 180, 0.85) 100%
    );
    transform: rotate(var(--tape-angle, -5deg));
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.15),
      inset 0 0 0 1px rgba(255, 255, 255, 0.3);
    opacity: 0.9;
    z-index: 10;
  }

  .tape::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      repeating-linear-gradient(
        90deg,
        transparent 0px,
        transparent 3px,
        rgba(0, 0, 0, 0.02) 3px,
        rgba(0, 0, 0, 0.02) 4px
      );
  }

  .tape-top {
    top: -10px;
    left: 50%;
    transform: translateX(-50%) rotate(var(--tape-angle, 0deg));
  }

  .tape-corner-left {
    top: -5px;
    left: -15px;
    transform: rotate(-45deg);
  }

  .tape-corner-right {
    top: -5px;
    right: -15px;
    transform: rotate(45deg);
  }

  /* Paper clip */
  .paperclip {
    position: absolute;
    width: 20px;
    height: 50px;
    border: 3px solid #888;
    border-radius: 10px 10px 0 0;
    border-bottom: none;
    top: -15px;
    right: 10px;
    transform: rotate(var(--clip-angle, 5deg));
    z-index: 10;
  }

  .paperclip::before {
    content: "";
    position: absolute;
    width: 12px;
    height: 35px;
    border: 3px solid #888;
    border-radius: 6px 6px 0 0;
    border-bottom: none;
    top: 10px;
    left: 1px;
  }

  /* === DEEP SHADOWS ON DRAG === */

  .evidence-card.dragging,
  .evidence-card:active {
    box-shadow:
      8px 16px 40px rgba(0, 0, 0, 0.5),
      4px 8px 20px rgba(0, 0, 0, 0.35),
      2px 4px 10px rgba(0, 0, 0, 0.25),
      0 0 0 1px rgba(0, 0, 0, 0.1) !important;
    transform: rotate(var(--rotation, 0deg)) scale(1.05) translateY(-8px);
    transition: box-shadow 0.15s ease, transform 0.15s ease;
  }

  /* Settled shadow - when dropped */
  .evidence-card.dropped {
    animation: settle-shadow 0.3s ease forwards;
  }

  @keyframes settle-shadow {
    0% {
      box-shadow:
        8px 16px 40px rgba(0, 0, 0, 0.5),
        4px 8px 20px rgba(0, 0, 0, 0.35);
      transform: rotate(var(--rotation, 0deg)) scale(1.05) translateY(-8px);
    }
    100% {
      box-shadow:
        2px 4px 12px rgba(0, 0, 0, 0.35),
        1px 2px 4px rgba(0, 0, 0, 0.2);
      transform: rotate(var(--rotation, 0deg)) scale(1) translateY(0);
    }
  }

  /* === HANDWRITING FONT VARIANTS === */

  .handwriting-1 { font-family: 'Permanent Marker', cursive; }
  .handwriting-2 { font-family: 'Caveat', cursive; }
  .handwriting-3 { font-family: 'Nanum Pen Script', cursive; }
  .handwriting-4 { font-family: 'Rock Salt', cursive; }
  .handwriting-5 { font-family: 'Shadows Into Light', cursive; }

  /* === EKG / HEARTBEAT SANITY METER === */

  .ekg-container {
    position: relative;
    width: 120px;
    height: 40px;
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(0, 255, 0, 0.3);
    border-radius: 4px;
    overflow: hidden;
  }

  .ekg-container::before {
    content: "";
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      to bottom,
      transparent 0px,
      transparent 1px,
      rgba(0, 255, 0, 0.1) 1px,
      rgba(0, 255, 0, 0.1) 2px
    );
    pointer-events: none;
  }

  .ekg-line {
    stroke-linecap: round;
    stroke-linejoin: round;
    fill: none;
    filter: drop-shadow(0 0 3px currentColor);
  }

  .ekg-pulse {
    animation: ekg-beep var(--pulse-rate, 1s) ease-in-out infinite;
  }

  @keyframes ekg-beep {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  /* Critical EKG - faster, erratic */
  .ekg-critical {
    animation:
      ekg-beep 0.3s ease-in-out infinite,
      ekg-shake 0.1s linear infinite;
  }

  @keyframes ekg-shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-1px); }
    75% { transform: translateX(1px); }
  }

  /* Flatline animation */
  .ekg-flatline {
    animation: flatline-beep 2s ease-in-out infinite;
  }

  @keyframes flatline-beep {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* === TYPEWRITER TEXT EFFECT === */

  .typewriter-text {
    font-family: 'Special Elite', 'Courier Prime', monospace;
    position: relative;
  }

  /* Ink bleed effect */
  .typewriter-text::before {
    content: attr(data-text);
    position: absolute;
    inset: 0;
    color: inherit;
    filter: blur(0.5px);
    opacity: 0.3;
    transform: translate(0.5px, 0.5px);
  }

  /* Smudge overlay */
  .ink-smudge {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='s'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='3' result='n'/%3E%3CfeDisplacementMap in='SourceGraphic' in2='n' scale='3' xChannelSelector='R' yChannelSelector='G'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23s)'/%3E%3C/svg%3E");
    filter: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='s'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='2'/%3E%3CfeDisplacementMap in='SourceGraphic' scale='2'/%3E%3C/filter%3E%3C/svg%3E#s");
  }

  /* === FLASHLIGHT / SPOTLIGHT EFFECT === */

  .flashlight-overlay {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 9996;
    background: radial-gradient(
      circle 150px at var(--mouse-x, 50%) var(--mouse-y, 50%),
      transparent 0%,
      rgba(0, 0, 0, 0.1) 30%,
      rgba(0, 0, 0, 0.5) 70%,
      rgba(0, 0, 0, 0.7) 100%
    );
    transition: background 0.05s ease;
    opacity: var(--flashlight-intensity, 0);
  }

  /* === POLAROID FRAME === */

  .polaroid-frame {
    background: linear-gradient(
      to bottom,
      #fefefe 0%,
      #f8f8f8 100%
    );
    padding: 8px 8px 40px 8px;
    box-shadow:
      0 3px 10px rgba(0, 0, 0, 0.2),
      0 1px 3px rgba(0, 0, 0, 0.1),
      inset 0 0 0 1px rgba(0, 0, 0, 0.05);
  }

  .polaroid-frame::after {
    content: attr(data-caption);
    position: absolute;
    bottom: 8px;
    left: 8px;
    right: 8px;
    text-align: center;
    font-family: 'Permanent Marker', cursive;
    font-size: 12px;
    color: #333;
  }

  /* === SCREEN FLICKER (Anxiety) === */

  .screen-flicker {
    animation: anxiety-flicker 0.15s linear infinite;
  }

  @keyframes anxiety-flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.98; }
    75% { opacity: 0.96; }
  }

  /* Heavy flicker for critical state */
  .screen-flicker-heavy {
    animation: heavy-flicker 0.1s linear infinite;
  }

  @keyframes heavy-flicker {
    0%, 100% { opacity: 1; filter: brightness(1); }
    25% { opacity: 0.95; filter: brightness(1.05); }
    50% { opacity: 0.92; filter: brightness(0.98); }
    75% { opacity: 0.97; filter: brightness(1.02); }
  }

  /* ========================================
     RESPONSIVE DESIGN SYSTEM
     Mobile-first approach for all screen sizes
     ======================================== */

  /* === RESPONSIVE EVIDENCE CARDS === */

  /* Mobile: Smaller cards for touch screens */
  .evidence-card-responsive {
    transform-origin: center;
    transition: transform 0.15s ease;
  }

  /* Touch device specific - larger hit areas */
  @media (pointer: coarse) {
    .react-flow__handle::after {
      width: 56px !important;
      height: 56px !important;
    }

    /* Larger touch targets for buttons */
    .touch-target {
      min-width: 44px;
      min-height: 44px;
    }
  }

  /* === MOBILE STYLES (< 640px) === */
  @media (max-width: 639px) {
    /* Reduce card sizes on mobile */
    .evidence-card,
    .evidence-photo,
    .evidence-document,
    .evidence-sticky {
      font-size: 0.85em;
    }

    /* Compact HUD elements */
    .hud-compact {
      padding: 0.375rem !important;
      gap: 0.25rem !important;
    }

    /* Smaller sanity meter on mobile */
    .sanity-meter-responsive {
      transform: scale(0.85);
      transform-origin: top right;
    }

    /* Stack controls vertically on very small screens */
    .controls-stack {
      flex-direction: column !important;
    }

    /* React Flow controls positioning for mobile */
    .react-flow__controls {
      bottom: 100px !important;
      left: 50% !important;
      right: auto !important;
      transform: translateX(-50%) !important;
      flex-direction: row !important;
    }

    /* Smaller font for terminal text on mobile */
    .terminal-text {
      font-size: 0.75rem;
    }

    /* Mobile-specific touch feedback */
    .touch-feedback:active {
      transform: scale(0.95);
      opacity: 0.9;
    }

    /* Adjust thread toggle position */
    .thread-toggle-mobile {
      top: auto !important;
      bottom: 160px !important;
      right: 8px !important;
    }

    /* Adjust UV light toggle position */
    .uv-toggle-mobile {
      top: auto !important;
      bottom: 100px !important;
      right: 8px !important;
    }

    /* Mobile menu improvements */
    .mobile-menu-item {
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
    }

    /* Better spacing in FilingCabinet on mobile */
    .case-list-mobile {
      gap: 0.5rem;
    }

    .case-list-mobile .grid-cols-12 {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
  }

  /* === TABLET STYLES (640px - 1023px) === */
  @media (min-width: 640px) and (max-width: 1023px) {
    .evidence-card,
    .evidence-photo,
    .evidence-document,
    .evidence-sticky {
      font-size: 0.9em;
    }

    /* Sanity meter scaling for tablet */
    .sanity-meter-responsive {
      transform: scale(0.9);
      transform-origin: top right;
    }

    /* React Flow controls for tablet */
    .react-flow__controls {
      bottom: 16px !important;
      right: 16px !important;
      left: auto !important;
    }
  }

  /* === DESKTOP STYLES (>= 1024px) === */
  @media (min-width: 1024px) {
    /* Full-size cards on desktop */
    .evidence-card,
    .evidence-photo,
    .evidence-document,
    .evidence-sticky {
      font-size: 1em;
    }

    /* Full-size sanity meter */
    .sanity-meter-responsive {
      transform: scale(1);
    }

    /* Desktop hover effects */
    .desktop-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
  }

  /* === LANDSCAPE MOBILE SPECIFIC === */
  @media (max-height: 500px) and (orientation: landscape) {
    /* Reduce vertical spacing in landscape mobile */
    .landscape-compact {
      padding-top: 0.5rem !important;
      padding-bottom: 0.5rem !important;
    }

    /* Position HUD to sides in landscape */
    .hud-landscape-left {
      top: 50% !important;
      left: 8px !important;
      transform: translateY(-50%) !important;
    }

    .hud-landscape-right {
      top: 50% !important;
      right: 8px !important;
      transform: translateY(-50%) !important;
    }

    /* Smaller controls in landscape */
    .react-flow__controls {
      transform: scale(0.8);
      bottom: 8px !important;
    }
  }

  /* === SAFE AREA INSETS (for notches and home indicators) === */
  @supports (padding: env(safe-area-inset-top)) {
    .safe-area-top {
      padding-top: env(safe-area-inset-top);
    }

    .safe-area-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }

    .safe-area-left {
      padding-left: env(safe-area-inset-left);
    }

    .safe-area-right {
      padding-right: env(safe-area-inset-right);
    }

    .safe-area-all {
      padding-top: env(safe-area-inset-top);
      padding-right: env(safe-area-inset-right);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
    }
  }

  /* === RESPONSIVE TYPOGRAPHY === */
  .text-responsive-xs {
    font-size: clamp(0.625rem, 2vw, 0.75rem);
  }

  .text-responsive-sm {
    font-size: clamp(0.75rem, 2.5vw, 0.875rem);
  }

  .text-responsive-base {
    font-size: clamp(0.875rem, 3vw, 1rem);
  }

  .text-responsive-lg {
    font-size: clamp(1rem, 3.5vw, 1.25rem);
  }

  .text-responsive-xl {
    font-size: clamp(1.125rem, 4vw, 1.5rem);
  }

  .text-responsive-2xl {
    font-size: clamp(1.25rem, 5vw, 2rem);
  }

  /* === RESPONSIVE SPACING === */
  .p-responsive {
    padding: clamp(0.5rem, 2vw, 1rem);
  }

  .gap-responsive {
    gap: clamp(0.25rem, 1.5vw, 0.75rem);
  }

  .m-responsive {
    margin: clamp(0.25rem, 1.5vw, 0.5rem);
  }

  /* === RESPONSIVE GRID FOR CASE FILES === */
  .case-grid-responsive {
    display: grid;
    gap: 0.5rem;
  }

  @media (max-width: 639px) {
    .case-grid-responsive {
      grid-template-columns: 1fr;
    }

    /* Simplified case row for mobile */
    .case-row-mobile {
      display: flex;
      flex-direction: column;
      padding: 0.75rem;
      gap: 0.25rem;
    }

    .case-row-mobile .case-title {
      font-size: 0.875rem;
      font-weight: bold;
    }

    .case-row-mobile .case-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      opacity: 0.8;
    }
  }

  @media (min-width: 640px) {
    .case-grid-responsive {
      grid-template-columns: repeat(12, minmax(0, 1fr));
    }
  }

  /* === PREVENT ZOOM ON INPUT FOCUS (iOS) === */
  @media (max-width: 767px) {
    input, select, textarea {
      font-size: 16px !important;
    }
  }

  /* === RESPONSIVE EVIDENCE NODE SIZES === */
  .node-size-mobile {
    --node-scale: 0.65;
  }

  .node-size-tablet {
    --node-scale: 0.8;
  }

  .node-size-desktop {
    --node-scale: 1;
  }

  /* Apply scaling to evidence nodes */
  .scaled-node {
    transform: scale(var(--node-scale, 1));
    transform-origin: top left;
  }

  /* === RESPONSIVE MODAL SIZES === */
  @media (max-width: 639px) {
    .modal-responsive {
      width: calc(100vw - 1rem) !important;
      max-width: none !important;
      margin: 0.5rem !important;
      max-height: calc(100vh - 1rem) !important;
      max-height: calc(100dvh - 1rem) !important;
    }
  }

  @media (min-width: 640px) and (max-width: 1023px) {
    .modal-responsive {
      width: calc(100vw - 2rem) !important;
      max-width: 600px !important;
      max-height: calc(100vh - 2rem) !important;
      max-height: calc(100dvh - 2rem) !important;
    }
  }

  /* === RESPONSIVE BUTTON SIZES === */
  .btn-responsive {
    padding: clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem);
    font-size: clamp(0.75rem, 2.5vw, 1rem);
    min-height: 44px;
    min-width: 44px;
  }

  /* === ORIENTATION-AWARE LAYOUTS === */
  @media (orientation: portrait) {
    .portrait-only { display: block; }
    .landscape-only { display: none; }

    .portrait-stack {
      flex-direction: column !important;
    }
  }

  @media (orientation: landscape) {
    .portrait-only { display: none; }
    .landscape-only { display: block; }

    .landscape-row {
      flex-direction: row !important;
    }
  }

  /* === HIGH DPI SCREENS === */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    /* Sharper borders on retina displays */
    .evidence-card,
    .evidence-photo,
    .evidence-document {
      border-width: 0.5px;
    }
  }

  /* === REDUCE MOTION FOR ACCESSIBILITY === */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }

    .film-grain,
    .crt-scanlines,
    .dust-particle {
      display: none !important;
    }
  }

  /* === THEORY MODE SELECTION === */
  .theory-selected {
    position: relative;
  }

  .theory-selected::after {
    content: "";
    position: absolute;
    inset: -8px;
    border: 3px solid #a855f7;
    border-radius: 8px;
    box-shadow:
      0 0 15px rgba(168, 85, 247, 0.6),
      0 0 30px rgba(168, 85, 247, 0.3),
      inset 0 0 15px rgba(168, 85, 247, 0.2);
    animation: theory-pulse 1.5s ease-in-out infinite;
    pointer-events: none;
    z-index: 100;
  }

  @keyframes theory-pulse {
    0%, 100% {
      border-color: rgba(168, 85, 247, 0.8);
      box-shadow:
        0 0 15px rgba(168, 85, 247, 0.6),
        0 0 30px rgba(168, 85, 247, 0.3);
    }
    50% {
      border-color: rgba(168, 85, 247, 1);
      box-shadow:
        0 0 25px rgba(168, 85, 247, 0.8),
        0 0 50px rgba(168, 85, 247, 0.4);
    }
  }
}
